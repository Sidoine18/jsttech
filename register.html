<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inscription Premium | JS TECH</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <style>
        :root {
            --primary: #0056b3;
            --accent: #ff914d;
            --dark: #0a0f1d;
            --card: #161e2d;
        }

        body {
            background: var(--dark);
            color: white;
            font-family: 'Inter', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        .reg-card {
            background: var(--card);
            padding: 40px;
            border-radius: 24px;
            width: 100%;
            max-width: 450px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px rgba(0,0,0,0.5);
            text-align: center;
        }

        .logo-placeholder { width: 100px; margin-bottom: 20px; }

        .form-group { text-align: left; margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; color: #94a3b8; font-size: 13px; }
        
        input, select {
            width: 100%; padding: 14px; background: #0f172a; border: 1px solid #334155;
            border-radius: 10px; color: white; box-sizing: border-box; outline: none;
        }

        .btn-submit {
            width: 100%; padding: 16px; background: var(--accent); color: #000;
            border: none; border-radius: 10px; font-weight: 800; cursor: pointer;
            font-size: 16px; transition: 0.3s; margin-top: 10px;
        }

        .btn-submit:hover { transform: scale(1.02); box-shadow: 0 10px 20px rgba(255, 145, 77, 0.3); }

        #qrcode { display: none; } /* On cache le QR code HTML, il ne sert qu'au PDF */

        .success-area { display: none; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div class="reg-card">
        <div id="form-ui">
            <img src="jst-service-logo.png" alt="JS TECH" class="logo-placeholder">
            <h2 style="color: var(--accent);">Inscription Officielle</h2>
            <p style="color: #64748b; margin-bottom: 30px;">Remplissez vos accès et téléchargez votre pass.</p>
            
            <form id="regForm">
                <div class="form-group">
                    <label>Nom & Prénoms</label>
                    <input type="text" id="name" placeholder="Ex: Sidoine AGOSSOU" required>
                </div>
                <div class="form-group">
                    <label>Numéro WhatsApp</label>
                    <input type="tel" id="tel" placeholder="+229 01 00 00 00" required>
                </div>
                <div class="form-group">
                    <label>Formation</label>
                    <select id="course_select">
                        <option value="Maintenance Informatique">Maintenance Informatique</option>
                        <option value="Bureautique Pro">Bureautique Pro</option>
                        <option value="Infographie">Infographie & Design</option>
                    </select>
                </div>
                <button type="submit" class="btn-submit">S'INSCRIRE & GÉNÉRER LE PASS</button>
            </form>
        </div>

        <div id="qrcode"></div>

        <div id="success-ui" class="success-area">
            <div style="font-size: 50px; color: #22c55e; margin-bottom: 20px;">✅</div>
            <h3>Félicitations !</h3>
            <p>Votre fiche d'inscription avec QR Code est prête.</p>
            <p style="font-size: 12px; color: #64748b;">Le téléchargement a démarré...</p>
            <br>
            <a href="index.html" style="color: var(--accent); text-decoration: none; font-weight: bold;">Retour à l'accueil</a>
        </div>
    </div>

    <script>
        const { jsPDF } = window.jspdf;

        document.getElementById('regForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const nom = document.getElementById('name').value;
            const tel = document.getElementById('tel').value;
            const formation = document.getElementById('course_select').value;
            const idKey = "JST-" + Math.random().toString(36).substr(2, 6).toUpperCase();
            const dateStr = new Date().toLocaleString('fr-FR');

            // 1. Générer le QR Code en arrière-plan
            const qrcodeDiv = document.getElementById("qrcode");
            qrcodeDiv.innerHTML = ""; // Clear
            const qr = new QRCode(qrcodeDiv, {
                text: `VERIF: ${idKey} | ELEVE: ${nom} | COURS: ${formation}`,
                width: 128,
                height: 128
            });

            // On attend une micro-seconde que le QR code soit rendu en image
            setTimeout(() => {
                const qrImage = qrcodeDiv.querySelector('canvas').toDataURL("image/png");
                generatePDF(nom, tel, formation, idKey, dateStr, qrImage);
            }, 500);
        });

        function generatePDF(nom, tel, formation, id, date, qrImg) {
            const doc = new jsPDF();

            // --- DESIGN DU PDF ---
            // Header Bleu
            doc.setFillColor(0, 86, 179);
            doc.rect(0, 0, 210, 50, 'F');

            // Texte Header
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(26);
            doc.setFont("helvetica", "bold");
            doc.text("JS TECH SERVICES", 20, 32);
            doc.setFontSize(10);
            doc.text("L'EXCELLENCE NUMÉRIQUE À BOHICON", 20, 40);

            // Corps du document
            doc.setTextColor(20, 20, 20);
            doc.setFontSize(16);
            doc.text("CONFIRMATION D'INSCRIPTION", 105, 70, { align: "center" });

            // Carte d'info (Rectangle gris clair)
            doc.setFillColor(245, 245, 245);
            doc.roundedRect(20, 80, 170, 100, 5, 5, 'F');

            doc.setFontSize(12);
            doc.setFont("helvetica", "bold");
            doc.text("ID Inscription :", 30, 95);
            doc.setFont("helvetica", "normal");
            doc.text(id, 70, 95);

            doc.setFont("helvetica", "bold");
            doc.text("Étudiant :", 30, 110);
            doc.setFont("helvetica", "normal");
            doc.text(nom, 70, 110);

            doc.setFont("helvetica", "bold");
            doc.text("Formation :", 30, 125);
            doc.setFont("helvetica", "normal");
            doc.text(formation, 70, 125);

            doc.setFont("helvetica", "bold");
            doc.text("Contact :", 30, 140);
            doc.setFont("helvetica", "normal");
            doc.text(tel, 70, 140);

            doc.setFont("helvetica", "bold");
            doc.text("Date :", 30, 155);
            doc.setFont("helvetica", "normal");
            doc.text(date, 70, 155);

            // AJOUT DU QR CODE
            doc.setFont("helvetica", "bold");
            doc.text("VÉRIFICATION SÉCURISÉE", 140, 135, { align: "center" });
            doc.addImage(qrImg, 'PNG', 130, 140, 40, 40);

            // Pied de page
            doc.setFontSize(9);
            doc.setTextColor(100, 100, 100);
            doc.text("Présentez ce QR Code au centre pour valider votre accès physique.", 105, 220, { align: "center" });
            doc.text("JS TECH - Avogbanna, Bohicon | +229 01 43 33 43 78", 105, 230, { align: "center" });

            // Bordure Orange de finition
            doc.setDrawColor(255, 145, 77);
            doc.setLineWidth(2);
            doc.line(0, 290, 210, 290);

            // Sauvegarde
            doc.save(`Fiche_Inscription_${nom}.pdf`);

            // UI Success
            document.getElementById('form-ui').style.display = 'none';
            document.getElementById('success-ui').style.display = 'block';
        }
    </script>
</body>
</html>